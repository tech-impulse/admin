<style>
    .thumb {
        height: 60px;
        border: 1px solid #000;
        margin: 10px 5px 0 0;
    }
    
    .btn-file {
        position: relative;
        overflow: hidden;
    }
    
    .btn-file input[type=file] {
        position: absolute;
        top: 0;
        right: 0;
        min-width: 100%;
        min-height: 100%;
        font-size: 100px;
        text-align: right;
        filter: alpha(opacity=0);
        opacity: 0;
        outline: none;
        background: white;
        cursor: inherit;
        display: block;
    }
    
    .img1 {
        margin-left: 30px;
        margin-top: 230px;
        position: relative;
    }
    
    .header {
        height: 370px;
    }
    
    #img2 {
        position: absolute;
        bottom: 25px;
        top: 100px;
        left: 25px;
        right: 25px;
    }
</style>

<form class="form-inline" role="form" enctype="multipart/form-data">
    <div class="row">
        <div class="col-lg-9" style="height: 600px; overflow-y: scroll;">
            <ul class="list-group" style="margin:10px" id="displayList">
            </ul>
        </div>
        <div class="col-lg-3">
            <div class="img1">
                <h4>Diseño del Layout</h4>
                <img id='img1' width="370" height="370" src="css/img/screen.png" />
                <img id='img2' width="320" height="245" src="css/img/screen.png" />
            </div>
            <br>
        </div>
    </div>
    <div class="row">
        <center>
            <div class="col-lg-3">
                <button type="button" class="btn btn-lg btn-success btn-file">
                    <i class="glyphicon glyphicon-plus"></i>
                    <span>Añadir Imagenes</span>
                    <input type="file" name="img" multiple id="imgInp">
                </button>
            </div>
            <div class="col-lg-3">
                <button onclick="openPopup('save')" type="button" class="btn btn-lg btn-primary">
                    <i class="glyphicon glyphicon-upload"></i>
                    <span>Guardar Diseño</span>
                </button>
            </div>
            <div class="col-lg-3">
                <button type="button" class="btn btn-lg btn-warning cancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>Cancelar Publicación</span>
                </button>
            </div>
            <div class="col-lg-3">
                <button type="button" class="btn btn-lg" onclick="changeDisplay(-1)">
                    <i class="glyphicon glyphicon-backward"></i>
                    <span></span>
                </button>
                <button type="button" class="btn btn-lg" onclick="playDisplay()">
                    <i id="btnPlay" class="glyphicon glyphicon-play"></i>
                    <span></span>
                </button>
                <button type="button" class="btn btn-lg" onclick="changeDisplay(1)">
                    <i class="glyphicon glyphicon-forward"></i>
                    <span></span>
                </button>
            </div>
        </center>
</form>

<script>
    var json = [];
    var jsonInfo = [];
    var playSecuence = '';
    var secuencePosition = 0;

    function handleFileSelect(evt) {

        var files = evt.target.files; // FileList object

        // Loop through the FileList and render image files as thumbnails.
        for (var i = 0, f; f = files[i]; i++) {

            // Only process image files.
            if (!f.type.match('image.*')) {
                // || !f.type.match('video.*')
                continue;
            }
            var reader = new FileReader();
            jsonInfo.push(f.name);
            // Closure to capture the file information.
            reader.onload = (function (theFile) {
                return function (e) {
                    json.push(e.target.result);

                    console.log(e.target);
                    addToList();
                };
            })(f);
            reader.readAsDataURL(f);
        }
    }
    document.getElementById('imgInp').addEventListener('change', handleFileSelect, false);

    function addToList() {
        $("#display").html('');
        var html = '';
        for (var j = 0; j < json.length; j++) {
            if (json[j] != undefined) {
                var img = '<img class="thumb" src="' + json[j] + '"/>';
                html = html + '<li class="list-group-item" id="line' + j + '"><div class="row"><div class="col-lg-2">' + img + '</div>' +
                    '<div class="col-lg-5"><h4>' + jsonInfo[j] + '</h4></div>' +
                    '<div class="col-lg-2">Barra</div>' +
                    '<div class="col-lg-1"><button class="btn glyphicon glyphicon-arrow-up" style="margin:1px" onclick="moveElement(' + j + ', -1)"></button>' +
                    '<button class="btn glyphicon glyphicon-arrow-down" onclick="moveElement(' + j + ', 1)"></button></div>' +
                    '<div class="col-lg-2"><h4><button class="btn btn-lg btn-danger" onclick="deleteLine(' + j + ')"> <i class="glyphicon glyphicon-trash"></i><span>Borrar</span></button></h4></div></li>'
            }
        }


        $("#displayList").html(html);
    }

    function deleteLine(line) {
        console.log(line);
        delete json[line];
        addToList();
    }

    function moveElement(from, type) {
        if (from == 0 && type == -1) {} else {
            var to = from + type;
            var element = json[from];
            json.splice(from, 1);
            json.splice(to, 0, element);
            element = jsonInfo[from];
            jsonInfo.splice(from, 1);
            jsonInfo.splice(to, 0, element);
            jsonInfo
            addToList();
        }
    }

    function playDisplay() {
        var secuencePosition = 0;
        if ($("#btnPlay").hasClass("glyphicon-play") && json.length > 0) {
            $("#btnPlay").toggleClass('glyphicon-play glyphicon-pause');
            document.getElementById("img2").src = json[secuencePosition - 1];
            playSecuence = setInterval(function () {
                document.getElementById("img2").src = json[secuencePosition - 1];
                if ((secuencePosition) == json.length) {
                    secuencePosition = 1;
                } else {
                    secuencePosition++;
                }
            }, 3000);
        } else {
            $("#btnPlay").removeClass('glyphicon-pause');
            $("#btnPlay").addClass('glyphicon-play');
            clearInterval(playSecuence);
        }

    }

    function changeDisplay(type) {
        var pos = secuencePosition + type;
        if (type == 1) {
            var pos = secuencePosition + type;
            if ($("#btnPlay").hasClass("glyphicon-play") && json.length > 0) {
                document.getElementById("img2").src = json[pos - 1];
                if ((secuencePosition + 1) == json.length) {
                    secuencePosition = 0;
                } else {
                    secuencePosition++;
                }
            } else {
                if (json.length > 0) {
                    document.getElementById("img2").src = json[pos - 1];
                    $("#btnPlay").removeClass('glyphicon-pause');
                    $("#btnPlay").addClass('glyphicon-play');
                    clearInterval(playSecuence);
                    if ((secuencePosition + 1) == json.length) {
                        secuencePosition = 0;
                    } else {
                        secuencePosition++;
                    }
                }
            }
            console.log(pos);
        }
        if (type == -1) {
            if ($("#btnPlay").hasClass("glyphicon-play") && json.length > 0) {
                if (pos == -2) {
                    secuencePosition = json.length - 1;
                    document.getElementById("img2").src = json[secuencePosition];
                    console.log(secuencePosition);
                    secuencePosition = secuencePosition - 1;
                } else {
                    document.getElementById("img2").src = json[secuencePosition];
                    console.log(secuencePosition);
                    secuencePosition = secuencePosition - 1;
                }
            } else {
                if (json.length > 0) {
                    document.getElementById("img2").src = json[pos];
                    $("#btnPlay").removeClass('glyphicon-pause');
                    $("#btnPlay").addClass('glyphicon-play');
                    clearInterval(playSecuence);
                    if (pos == -1) {
                        secuencePosition = json.length;
                    } else {
                        secuencePosition = secuencePosition - 1;
                    }
                }
            }

        }
    }

    function openPopup(type) {
        swal({
            title: "Información",
            text: "¿Desea guardar la plantilla?",
            type: "input",
            showCancelButton: true,
            closeOnConfirm: false,
            animation: "slide-from-top",
            inputPlaceholder: "Nombre de la plantilla"
        }, function (inputValue, isConfirm) {
            if (inputValue === false) return false;
            if (inputValue === "") {
                swal.showInputError("El campo está vacío!");
                return false
            }
            swal("Plantilla Guardada!", inputValue, "success");
            console.log("plantilla guardada " + inputValue);
        });
    }

    $("#btn").click(function () {
        console.log("click");
        $("#imgInp").click();
    })
</script>