<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <script src='js/jquery-1.11.3.min.js'></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link href='lib/fullcalendar-2.4.0/fullcalendar.css' rel='stylesheet' />
    <link href='lib/fullcalendar-2.4.0/fullcalendar.print.css' rel='stylesheet' media='print' />
    <script type="text/javascript" src="lib/datepicker/moment.js"></script>
    <script type="text/javascript" src="lib/datepicker/bootstrap-datetimepicker.min.js"></script>
    <link rel="stylesheet" href="lib/datepicker/bootstrap-datetimepicker.min.css">
    <script src='lib/fullcalendar-2.4.0/fullcalendar.min.js'></script>
    <script src='lib/fullcalendar-2.4.0//lang/es.js'></script>
    <script src="lib/swal/sweetalert2.min.js"></script>
    <link rel="stylesheet" type="text/css" href="lib/swal/sweetalert2.css">
    <script>
        var calendarData = [
            {
                "id": 0,
                "title": "All Day Event",
                "start": "2015-10-24",
                "end": "2015-10-26",
                "minTime": "10:00:15",
                "maxTime": "14:20:15",
                "anual": true,
                "allDay": false

                        }
                    ];
        $(document).ready(function () {


            $('#calendar').fullCalendar({
                dayClick: function (date, jsEvent, view) {
                    testSwal(date.format());
                    console.log(date.format());
                    //alert('Clicked on: ' + date.format());
                    //$(this).css('background-color', 'red');

                },
                eventClick: function (calEvent, jsEvent, view) {
                    testSwal('', calEvent);
                    //$(this).css('border-color', 'red');

                },
                eventMouseover: function (calEvent, jsEvent, view) {
                    $("#texto").text(calEvent.descripcion);
                    //console.log('Haz algo con: ' + calEvent.title);
                },
                eventMouseout: function (calEvent, jsEvent, view) {
                    //document.elementFromPoint(0, 0).click();
                    $("#texto").text('');
                    // console.log('Deja de hacer algo con: ' + calEvent.title);
                },
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                defaultDate: '2015-02-12',
                editable: false,
                eventLimit: false, // allow "more" link when too many events
                lang: 'es',
                events: calendarData,
                loading: function (bool) {
                        $('#loading').toggle(bool);
                    }
                    /*
				url: 'php/get-events.php',
				error: function() {
					$('#script-warning').show();
				}
                */
            });
            $('#calendar').fullCalendar('today');

        });

        function testSwal(data, evento) {
            var id_evento ='';
            if(evento != undefined){
                var id_evento = evento.id;
            }
            var html = 
                '<a style="margin:10px" id="btn_popup_programacion" onclick="borrar_programacion('+id_evento+')" type="button" class="btn btn-danger btn-md">' +
                '<i class="glyphicon glyphicon-trash"></i> Eliminar Programación' +
                '</a>' +
                '<div class="alert alert-info" role="alert">Programación del evento</div>' +
                '<div class="panel panel-success">' +
                '<div class="panel-heading">' +
                '<h3 class="panel-title">Selecciona un rango de fechas</h3>' +
                '</div>' +
                '<div class="panel-body">' +
                '<div class="row">' +
                '<div class="col-lg-5">' +
                '<label style="padding-right:45px">Día de inicio: </label>' +
                '<div class="input-group date" id="datetimepicker1">' +
                '<input type="text" class="form-control"/>' +
                '<span class="input-group-addon">' +
                '<span class="glyphicon glyphicon-calendar"></span>' +
                '</span>' +
                '</div>' +
                '</div>' +
                '<div class="col-lg-5">' +
                '<label style="padding-right:80px">Dia de fin: </label>' +
                '<div style="padding-right:5px" class="input-group date" id="datetimepicker2">' +
                '<input type="text" class="form-control" />' +
                '<span class="input-group-addon">' +
                '<span class="glyphicon glyphicon-calendar"></span>' +
                '</span>' +
                '</div>' +
                '</div>' +
                '<div class="col-lg-2">' +
                '<span>Sin limite</span>' +
                '<input id="check_popup_programacion_fecha" type="checkbox">' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="panel panel-success">' +
                '<div class="panel-heading">' +
                '<h3 class="panel-title">Seleccionar un horario de emisión</h3>' +
                '</div>' +
                '<div class="panel-body">' +
                '<div class="row">' +
                '<div class="col-lg-5">' +
                '<label style="padding-right:40px">Hora de inicio: </label>' +
                '<div style="padding-right:20px" class="input-group date" id="datetimepicker3">' +
                '<input type="text" class="form-control" />' +
                '<span class="input-group-addon">' +
                '<span class="glyphicon glyphicon-calendar"></span>' +
                '</span>' +
                '</div>' +
                '</div>' +
                '<div class="col-lg-5">' +
                '<label style="padding-right:70px">Hora de fin: </label>' +
                '<div style="padding-right:5px" class="input-group date" id="datetimepicker4">' +
                '<input type="text" class="form-control" />' +
                '<span class="input-group-addon">' +
                '<span class="glyphicon glyphicon-calendar"></span>' +
                '</span>' +
                '</div>' +
                '</div>' +
                '<div class="col-lg-2">' +
                '<span>Todo el día</span>' +
                '<input id="check_popup_programacion_horario" type="checkbox" value="remember-me">' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<input type="text" id="in_popup_programacion" placeholder="Nombre del evento">' +
                '<br><label style="display:none; color:red; margin-top:10px" id="sp_popup_programacion">Compruebe los datos!</label>';
            swal({
                html: html,
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Publicar!',
                closeOnConfirm: false
            }, function () {
                if ($('#datetimepicker1').data("date") != undefined &&
                    ($('#datetimepicker2').data("date") != undefined || $('#check_popup_programacion_fecha').is(":checked")) && (($('#datetimepicker3').data("date") != undefined && $('#datetimepicker4').data("date") != undefined) || $('#check_popup_programacion_horario').is(":checked")) && $("#in_popup_programacion").val() != "") {

                    var dinicio = $('#datetimepicker1').data("date");
                    var dfinal = $('#datetimepicker2').data("date");
                    var hinicio = $('#datetimepicker3').data("date");
                    var hfinal = $('#datetimepicker4').data("date");
                    var titulo = $("#in_popup_programacion").val();
                    var nuevosDatos = {};
                    nuevosDatos['title'] = titulo;
                    nuevosDatos['start'] = dinicio;
                    $('#check_popup_programacion_fecha').is(":checked")
                    if ($('#check_popup_programacion_fecha').is(":checked")) {
                        nuevosDatos['end'] = '2099-12-31';
                        nuevosDatos['anual'] = true;
                    } else {
                        nuevosDatos['end'] = dfinal;
                        nuevosDatos['anual'] = false;
                    }
                    if ($('#check_popup_programacion_horario').is(":checked")) {
                        nuevosDatos['minTime'] = '00:00:00';
                        nuevosDatos['maxTime'] = '00:00:00';
                        nuevosDatos['allDay'] = true;
                    } else {
                        nuevosDatos['minTime'] = hinicio;
                        nuevosDatos['maxTime'] = hfinal;
                        nuevosDatos['allDay'] = false;
                    }
                    calendarData.push(nuevosDatos);
                    swal("Guardado!",
                        "Se ha guardado su programación.",
                        "success");
                    $('#calendar').fullCalendar('addEventSource', calendarData);
                    //$('#calendar').fullCalendar( 'renderEvent', nuevosDatos );

                    //postPlantillas($("#in_popup_guardar").val(), $("#txt_popup_guardar").val(), multimedia_seleccionada);
                } else {
                    $("#sp_popup_programacion").show();
                }
                console.log("Plantilla " + titulo + " De " + dinicio + " a " + dfinal + " con horario de " + hinicio + " a " + hfinal);
            });
            $(function () {
                $('#datetimepicker1').datetimepicker({
                    format: 'YYYY-MM-DD'
                });
                $('#datetimepicker2').datetimepicker({
                    format: 'YYYY-MM-DD',
                });
                $('#datetimepicker3').datetimepicker({
                    //format: 'LT'
                    format: 'h:mm:ss'
                });
                $('#datetimepicker4').datetimepicker({
                    //format: 'LT'
                    format: 'h:mm:ss'
                });

                if (evento != undefined) {
                    console.log(evento);
                    $('#datetimepicker1').data("DateTimePicker").date(evento.start);
                    $('#datetimepicker2').data("DateTimePicker").date(evento.end);
                    $('#datetimepicker3').data("DateTimePicker").date(evento.minTime);
                    $('#datetimepicker4').data("DateTimePicker").date(evento.maxTime);
                    $("#in_popup_programacion").val(evento.title);
                    $("#btn_popup_programacion").show();
                    if (evento.anual) {
                        setTimeout(function () {
                            $("#check_popup_programacion_fecha").click();
                        }, 100);
                    }
                    if (evento.allDay) {
                        setTimeout(function () {
                            $("#check_popup_programacion_horario").click();
                        }, 100);
                    }

                } else {
                    $('#datetimepicker1').data("DateTimePicker").date(data);
                    $('#datetimepicker2').data("DateTimePicker").minDate(data);
                    $("#btn_popup_programacion").hide();
                }

                $('#check_popup_programacion_fecha').change(function () {
                    if ($(this).is(":checked")) {
                        $('#datetimepicker2 input').prop("disabled", true);
                    } else {
                        $('#datetimepicker2 input').prop("disabled", false);
                    }
                });
                $('#check_popup_programacion_horario').change(function () {
                    if ($(this).is(":checked")) {
                        $('#datetimepicker3 input').prop("disabled", true);
                        $('#datetimepicker4 input').prop("disabled", true);
                    } else {
                        $('#datetimepicker3 input').prop("disabled", false);
                        $('#datetimepicker4 input').prop("disabled", false);
                    }
                });
            });
        }

        function borrar_programacion(id) {
            console.log("borra");
             var alert = document.querySelector(".sweet-alert"),
                okButton = alert.getElementsByTagName("button")[1];
                $(okButton).trigger("click");
                setTimeout(function () {
               
                swal("borra esta " + id)
            }, 500);
        }
        // Asi se accede a la info $('#calendar').fullCalendar('clientEvents');
    </script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "Lucida Grande", Helvetica, Arial, Verdana, sans-serif;
            font-size: 14px;
        }
        
        #script-warning {
            display: none;
            background: #eee;
            border-bottom: 1px solid #ddd;
            padding: 0 10px;
            line-height: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            color: red;
        }
        
        #loading {
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        #calendar {
            max-width: 900px;
            margin: 40px auto;
            padding: 0 10px;
        }
    </style>
</head>

<body>

    <div id='script-warning'>
        <code>php/get-events.php</code> must be running.
    </div>


    <div id='loading'>loading...</div>
    <div id="test">
        <label id="texto"></label>
    </div>
    <div id='calendar'></div>

</body>

</html>